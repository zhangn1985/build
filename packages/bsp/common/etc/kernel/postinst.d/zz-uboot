#!/bin/sh
echo "update kernel: Converting to u-boot format"

case `uname -m` in
	aarch64) ARCH=arm64;;
	armhf) ARCH=arm;;
	*) exit 1;;
esac

if [ -f /boot/uImage.old ]; then rm /boot/uImage.old; fi
if [ -f /boot/uImage ]; then mv /boot/uImage /boot/uImage.old; fi
ln -s $2 /boot/uImage

echo "update initrd: Converting to u-boot format"

if [ -f /boot/uInitrd.old ]; then rm /boot/uInitrd.old; fi
if [ -f /boot/uInitrd ]; then mv /boot/uInitrd /boot/uInitrd.old; fi
mkimage -A $ARCH -O linux -T ramdisk -C gzip -n "Linux initrd" -d /boot/initrd.img-$1 /boot/uInitrd
